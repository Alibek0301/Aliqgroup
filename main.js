    // Языки
const langs = {
  ru: {
        siteTitle: "AliQ Group",
        slogan: "IT-решения для бизнеса и безопасности.<br>Компетентность. Скорость. Надёжность.",
        heroDesc: "Молодая ИТ-компания. Запускаем цифровые продукты, интегрируем сервисы, делаем ваш бизнес защищённым и современным.<br><b>Первый проект: AliGuard (MVP, платформа для охранных агентств).</b>",
        requestBtn: "Оставить заявку",
        servicesTitle: "Наши услуги",
        services: [
          "Разработка MVP (цифровых продуктов)",
          "Интеграция сервисов (CRM, облако, чаты, API)",
          "Создание современных сайтов и лендингов",
          "IT-консалтинг и аудит",
          "Автоматизация бизнес-процессов",
          "Информбезопасность и защита данных"
        ],
        projectsTitle: "Проекты и опыт",
        projects: [
          "AliGuard — цифровая платформа для поиска охранных услуг (MVP)",
          "Чат-боты для бизнеса (Telegram, WhatsApp)",
          "Внедрение облачных сервисов и автоматизация",
          "Сайты для учебных центров, сервисных компаний"
        ],
        advTitle: "Почему выбирают нас?",
        adv: [
          "Комплексный подход: от идеи до запуска",
          "Гибкость, работа без бюрократии",
          "Глубокое понимание ИТ и безопасности",
          "Прозрачная коммуникация и честность",
          "Реальный опыт работы в Казахстане и СНГ"
        ],
        founderTitle: "Руководитель: Алибек Уразов",
        founderDesc: "Офицер запаса, инженер. 20+ лет в безопасности и ИТ. Эксперт в вопросах физической и цифровой защиты.",
        contactsTitle: "Контакты",
        phoneLabel: "Телефон (WhatsApp):",
        namePlaceholder: "Ваше имя",
        phonePlaceholder: "Телефон",
        emailPlaceholder: "Email (необязательно)",
        serviceLabelText: "Услуга:",
        questionPlaceholder: "Ваш вопрос",
        messengerLabel: "Отправить через:",
        submitBtn: "Отправить",
        formSuccess: "Спасибо! Ваша заявка отправлена.",
    qrText: "Сканируйте QR код или скопируйте ссылку на сайт:",
    langBtn: "Қазақша",
    navHome: "Главная",
    navServices: "Услуги",
    navSchedule: "Встреча",
    navPortfolio: "Портфолио",
    scheduleTitle: "Запланировать консультацию",
    scheduleDesc: "Используйте наш календарь, чтобы выбрать удобное время.",
    scheduleBtn: "Открыть календарь"
  },
  kz: {
        siteTitle: "AliQ Group",
        slogan: "Бизнес пен қауіпсіздікке арналған IT-шешімдер.<br>Кәсібилік. Жылдамдық. Сенімділік.",
        heroDesc: "Жас IT-компания. Цифрлық өнімдерді іске қосамыз, сервистерді біріктіреміз, бизнесіңізді заманауи әрі қорғалған етеміз.<br><b>Бірінші жоба: AliGuard (MVP, күзет агенттіктеріне арналған платформа).</b>",
        requestBtn: "Өтініш қалдыру",
        servicesTitle: "Қызметтеріміз",
        services: [
          "MVP әзірлеу (цифрлық өнімдер)",
          "Сервистерді біріктіру (CRM, бұлт, чаттар, API)",
          "Заманауи сайттар мен лендингтер жасау",
          "IT-кеңес және аудит",
          "Бизнес-процестерді автоматтандыру",
          "Информқауіпсіздік және деректерді қорғау"
        ],
        projectsTitle: "Жобалар мен тәжірибе",
        projects: [
          "AliGuard — күзет агенттіктеріне арналған цифрлық платформа (MVP)",
          "Бизнеске арналған чат-боттар (Telegram, WhatsApp)",
          "Бұлттық сервистерді енгізу және автоматтандыру",
          "Оқу орталықтарына, сервис компанияларға сайттар"
        ],
        advTitle: "Бізді не үшін таңдайды?",
        adv: [
          "Идеядан іске қосуға дейін толық цикл",
          "Икемділік, бюрократиясыз жұмыс",
          "IT және қауіпсіздікті терең түсіну",
          "Ашық және әділ коммуникация",
          "Қазақстан мен ТМД-дағы нақты тәжірибе"
        ],
        founderTitle: "Басшы: Әлібек Уразов",
        founderDesc: "Запастағы офицер, инженер. 20+ жыл қауіпсіздік және IT саласында. Физикалық және цифрлық қорғаныс жөніндегі сарапшы.",
        contactsTitle: "Байланыс",
        phoneLabel: "Телефон (WhatsApp):",
        namePlaceholder: "Атыңыз",
        phonePlaceholder: "Телефон",
        emailPlaceholder: "Email (міндетті емес)",
        serviceLabelText: "Қызмет:",
        questionPlaceholder: "Сұрағыңыз",
        messengerLabel: "Қай мессенджер арқылы жіберу:",
        submitBtn: "Жіберу",
        formSuccess: "Рақмет! Өтінішіңіз жіберілді.",
    qrText: "QR кодын сканерлеңіз немесе сілтемені көшіріңіз:",
    langBtn: "English",
    navHome: "Басты бет",
    navServices: "Қызметтер",
    navSchedule: "Кездесу",
    navPortfolio: "Портфолио",
    scheduleTitle: "Кеңес жоспарлау",
    scheduleDesc: "Ыңғайлы уақытты таңдау үшін күнтізбені пайдаланыңыз.",
    scheduleBtn: "Күнтізбені ашу"
  },
  en: {
    siteTitle: "AliQ Group",
    slogan: "IT solutions for business and security.<br>Expertise. Speed. Reliability.",
    heroDesc: "A young IT company launching digital products, integrating services and keeping your business safe.<br><b>First project: AliGuard (MVP, platform for security agencies).</b>",
    requestBtn: "Send request",
    servicesTitle: "Our services",
    services: [
      "MVP development",
      "Service integration (CRM, cloud, chats, API)",
      "Modern websites and landing pages",
      "IT consulting and audit",
      "Business process automation",
      "Information security"
    ],
    projectsTitle: "Projects & experience",
    projects: [
      "AliGuard — digital platform for security agencies (MVP)",
      "Chat bots for business (Telegram, WhatsApp)",
      "Cloud services integration and automation",
      "Websites for training centers and service companies"
    ],
    advTitle: "Why choose us?",
    adv: [
      "Full cycle from idea to launch",
      "Flexibility without bureaucracy",
      "Deep IT and security expertise",
      "Transparent communication",
      "Real experience in Kazakhstan and CIS"
    ],
    founderTitle: "Founder: Alibek Urazov",
    founderDesc: "Reserve officer, engineer. 20+ years in security and IT.",
    contactsTitle: "Contacts",
    phoneLabel: "Phone (WhatsApp):",
    namePlaceholder: "Your name",
    phonePlaceholder: "Phone",
    emailPlaceholder: "Email (optional)",
    serviceLabelText: "Service:",
    questionPlaceholder: "Your question",
    messengerLabel: "Send via:",
    submitBtn: "Send",
    formSuccess: "Thank you! Your request has been sent.",
    qrText: "Scan the QR code or copy the link:",
    langBtn: "Русский",
    navHome: "Home",
    navServices: "Services",
    navSchedule: "Meeting",
    navPortfolio: "Portfolio",
    scheduleTitle: "Schedule a consultation",
    scheduleDesc: "Use our calendar to pick a convenient time.",
    scheduleBtn: "Open calendar"
  }
};
// Вопросы по услугам
const serviceQuestions = {
  ru: [
    ['Описание проекта','Желаемые сроки','Предполагаемый бюджет','Контактное лицо','Дополнительная информация'],
    ['Текущие системы','Планируемые интеграции','Сроки внедрения','Ответственный специалист','Комментарии'],
    ['Тип сайта (корпоративный, лендинг и др.)','Предпочтительный дизайн','Примеры сайтов','Контакты и доп. пожелания'],
    ['Область аудита (инфраструктура, процессы и др.)','Цели консультации','Желаемые результаты','Время для проведения'],
    ['Основные задачи/процессы','Используемые инструменты','Проблемы, которые требуется решить','Сроки','Контактное лицо'],
    ['Текущая IT‑инфраструктура','Приоритетные риски/угрозы','Требуемые меры защиты','Контакты для связи']
  ],
  kz: [
    ['Жоба сипаттамасы','Қалаған мерзім','Болжамды бюджет','Байланыс тұлғасы','Қосымша ақпарат'],
    ['Қолданыстағы жүйелер','Жоспарланған біріктірулер','Енгізу мерзімі','Жауапты маман','Пікірлер'],
    ['Сайт түрі (корпоративтік, лендинг т.б.)','Қалаған дизайн','Сайт үлгілері','Байланыс және қосымша тілектер'],
    ['Аудит саласы (инфрақұрылым, процестер және т.б.)','Консультация мақсаты','Күтілетін нәтиже','Өткізу уақыты'],
    ['Негізгі міндеттер/процестер','Қолданылатын құралдар','Шешілуі тиіс мәселелер','Мерзімдер','Байланыс тұлғасы'],
    ['Қолданыстағы IT-инфрақұрылым','Маңызды қауіп-қатерлер','Қажетті қорғау шаралары','Байланыс үшін деректер']
  ],
  en: [
    ['Project description','Desired timeline','Estimated budget','Contact person','Additional info'],
    ['Current systems','Planned integrations','Implementation timeframe','Responsible specialist','Comments'],
    ['Type of site (corporate, landing, etc.)','Preferred design','Example sites','Contacts and wishes'],
    ['Audit scope (infrastructure, processes, etc.)','Consultation goals','Desired results','Time for conducting'],
    ['Key tasks/processes','Tools in use','Problems to solve','Timeline','Contact person'],
    ['Current IT infrastructure','Priority risks/threats','Required protection measures','Contact details']
  ]
};

const serviceIcons = ['bi-lightning','bi-diagram-3','bi-window','bi-puzzle','bi-gear','bi-shield-lock'];

let curLang = 'ru';
function setElText(id, html){ const el = document.getElementById(id); if(el) el.innerHTML = html; }
function setLang(lang) {
  curLang = lang;
  const l = langs[lang];
  setElText('siteTitle', l.siteTitle);
  setElText('slogan', l.slogan);
  setElText('heroDesc', l.heroDesc);
  document.querySelectorAll('#requestBtn, #requestBtn2').forEach(btn => btn && (btn.innerText = l.requestBtn));
  setElText('servicesTitle', l.servicesTitle);
  const servicesEl = document.getElementById('servicesList');
  if(servicesEl) servicesEl.innerHTML = l.services.map((s,i)=>`<li><i class="bi ${serviceIcons[i]} service-icon"></i> ${s} <button class="service-btn" onclick="openModal('${s}')">${l.requestBtn}</button></li>`).join('');
  setElText('projectsTitle', l.projectsTitle);
  const projectsEl = document.getElementById('projectsList');
  if(projectsEl) projectsEl.innerHTML = l.projects.map(p=>`<li>${p}</li>`).join('');
  setElText('advTitle', l.advTitle);
  const advEl = document.getElementById('advList');
  if(advEl) advEl.innerHTML = l.adv.map(a=>`<li>${a}</li>`).join('');
  setElText('founderTitle', l.founderTitle);
  setElText('founderDesc', l.founderDesc);
  setElText('contactsTitle', l.contactsTitle);
  setElText('phoneLabel', l.phoneLabel);
  const nameInput=document.getElementById('nameInput'); if(nameInput) nameInput.placeholder = l.namePlaceholder;
  const phoneInput=document.getElementById('phoneInput'); if(phoneInput) phoneInput.placeholder = l.phonePlaceholder;
  const emailInput=document.getElementById('emailInput'); if(emailInput) emailInput.placeholder = l.emailPlaceholder;
  const qInput=document.getElementById('questionInput'); if(qInput) qInput.placeholder = l.questionPlaceholder;
  const servLabel=document.getElementById('serviceLabel'); if(servLabel) servLabel.innerText = l.serviceLabelText;
  setElText('messengerLabel', l.messengerLabel);
  const submit=document.getElementById('submitBtn'); if(submit) submit.innerText = l.submitBtn;
  const langBtn=document.getElementById('langBtn'); if(langBtn) langBtn.innerText = l.langBtn;
  setElText('navHome', l.navHome);
  setElText('navServices', l.navServices);
  setElText('navSchedule', l.navSchedule);
  setElText('navPortfolio', l.navPortfolio);
  setElText('scheduleTitle', l.scheduleTitle);
  setElText('scheduleDesc', l.scheduleDesc);
  const schedBtn=document.getElementById('scheduleBtn'); if(schedBtn) schedBtn.innerText = l.scheduleBtn;
  setElText('formMsg', l.formSuccess);
  setElText('qrText', l.qrText);
}
    document.getElementById('langBtn').onclick = function() {
      setLang(curLang==='ru' ? 'kz' : (curLang==='kz' ? 'en' : 'ru'));
    };
const yearEls = document.querySelectorAll('#year, #year2, #year3');
yearEls.forEach(el => el.innerText = new Date().getFullYear());
const qrCodeEl = document.getElementById('qrCode');
if(qrCodeEl){
  qrCodeEl.src = 'https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=' + encodeURIComponent(window.location.href);
  const siteLink = document.getElementById('siteLink');
  if(siteLink) siteLink.value = window.location.href;
}

function renderQuestions(service){
  const fieldsEl = document.getElementById('dynamicFields');
  const qInput = document.getElementById('questionInput');
  fieldsEl.innerHTML = '';
  if(!service){
    qInput.style.display = 'block';
    qInput.required = true;
    return;
  }
  const idx = langs[curLang].services.indexOf(service);
  const list = serviceQuestions[curLang][idx] || [];
  if(list.length===0){
    qInput.style.display = 'block';
    qInput.required = true;
    return;
  }
  qInput.style.display = 'none';
  qInput.required = false;
  fieldsEl.innerHTML = list.map(l=>`<input type="text" data-label="${l}" placeholder="${l}" class="dyn-field">`).join('');
}

    // Модалка
function openModal(service) {
  document.getElementById('modalBg').style.display = 'flex';
  document.getElementById('formMsg').style.display = 'none';
  const form = document.querySelector('#modalBg form');
  form.reset();
  document.getElementById('serviceName').innerText = service || '';
  document.getElementById('serviceInput').value = service || '';
  renderQuestions(service);
}
    function closeModal() {
      document.getElementById('modalBg').style.display = 'none';
    }
    window.openModal = openModal; window.closeModal = closeModal;

    // Отправка формы и переход в мессенджер
    async function sendForm(e) {
      e.preventDefault();
      const name = document.getElementById('nameInput').value;
      const phone = document.getElementById('phoneInput').value;
      const email = document.getElementById('emailInput').value;
      const service = document.getElementById('serviceInput').value;
      const questionInputEl = document.getElementById('questionInput');
      const extra = Array.from(document.querySelectorAll('#dynamicFields .dyn-field'))
        .map(f => `${f.dataset.label}: ${f.value}`)
        .filter(Boolean)
        .join('\n');
      const question = [extra, questionInputEl.value].filter(Boolean).join('\n');
      const messenger = document.getElementById('messengerSelect').value;
      const msgEl = document.getElementById('formMsg');
      msgEl.style.display = 'block';
      try {
        const res = await fetch('/api/feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, phone, email, service, question, messenger })
        });
        if (!res.ok) throw new Error('fail');
        msgEl.style.color = '#37ff86';
      } catch (err) {
        console.error(err);
        msgEl.style.color = '#ffb347';
      }
      msgEl.innerText = langs[curLang].formSuccess;

      const text = encodeURIComponent(`Имя: ${name}\nТелефон: ${phone}\nEmail: ${email}\nУслуга: ${service}\nВопрос: ${question}`);
      let url = '';
      if (messenger === 'whatsapp') {
        url = `https://wa.me/77052546613?text=${text}`;
      } else {
        url = `https://t.me/aliqgroup?text=${text}`;
      }
      window.open(url, '_blank');

      document.querySelector('#modalBg form').reset();
      setTimeout(closeModal, 1800);
    }
    window.sendForm = sendForm;

    // Первичная установка языка
    setLang(curLang);

    const observer = new IntersectionObserver(entries => {
      entries.forEach(e => {
        if(e.isIntersecting) e.target.classList.add('visible');
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
