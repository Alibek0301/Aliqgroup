    // Языки
const langs = {
  ru: {
        siteTitle: "AliQ Group",
        slogan: "IT-решения для бизнеса и безопасности.<br>Компетентность. Скорость. Надёжность.",
        heroDesc: "Молодая ИТ-компания. Запускаем цифровые продукты, интегрируем сервисы, делаем ваш бизнес защищённым и современным.<br><b>Первый собственный проект <a href=\"http://aliguard.kz/\" target=\"_blank\">Aliguard.kz</a> (платформа для поиска охранных услуг).</b>",
        requestBtn: "Оставить заявку",
        servicesTitle: "Наши услуги",
        services: [
          "Разработка MVP (цифровых продуктов)",
          "Интеграция сервисов (CRM, облако, чаты, API)",
          "Создание современных сайтов и лендингов",
          "IT-консалтинг и аудит",
          "Автоматизация бизнес-процессов",
          "Информбезопасность и защита данных"
        ],
        projectsTitle: "Проекты и опыт",
        projects: [
          "<a href=\"http://aliguard.kz/\" target=\"_blank\">Aliguard.kz</a> — цифровая платформа для поиска охранных услуг (MVP)",
          "Чат-боты для бизнеса (Telegram, WhatsApp)",
          "Внедрение облачных сервисов и автоматизация",
          "Сайты для учебных центров, сервисных компаний"
        ],
        advTitle: "Почему выбирают нас?",
        adv: [
          "Комплексный подход: от идеи до запуска",
          "Гибкость, работа без бюрократии",
          "Глубокое понимание ИТ и безопасности",
          "Прозрачная коммуникация и честность",
          "Реальный опыт работы в Казахстане и СНГ"
        ],
        founderTitle: "Основатели компании",
        founderDesc: "<div class=\"founder-list\"><div class=\"founder-desc\">Алибек Уразов, эксперт по физической и цифровой защите. Офицер запаса, инженер, более 20 лет в безопасности и ИТ. Амангелді Темірлан, frontend-разработчик с практическим опытом создания мобильных и веб приложений(HTML, CSS, Fluter, Figma, React и т.д.)   Шарыкпаев Арлан, backend-разработчик с практическим опытом и создания мобильных и веб приложений(Postgre SQL, MySQL, Python, Java, MongoDB и т.д.)   Жумадиллаев Аян, SMM-менеджер с практическим опытом ведения IT. Владение методологиями Agile/Scrum, Trello, Jira, Notion(от идеи до реализации)</div></div><div class=\"founder-desc\">Участвовали в крупных проектах, имеем международные сертификаты и строго соблюдаем конфиденциальность.</div>",
        contactsTitle: "Контакты",
        phoneLabel: "Телефон (WhatsApp):",
        namePlaceholder: "Ваше имя",
        phonePlaceholder: "Телефон",
        emailPlaceholder: "Email (необязательно)",
        serviceLabelText: "Услуга:",
        questionPlaceholder: "Ваш вопрос",
        messengerLabel: "Отправить через:",
        submitBtn: "Отправить",
        formSuccess: "Спасибо! Ваша заявка отправлена.",
    qrText: "Сканируйте QR код или скопируйте ссылку на сайт:",
    langBtn: "Қазақша",
    navHome: "Главная",
    navServices: "Услуги",
    navSchedule: "Встреча",
    navFAQ: "FAQ",
    scheduleTitle: "Запланировать консультацию",
    scheduleDesc: "Используйте наш календарь, чтобы выбрать удобное время.",
    scheduleBtn: "Открыть календарь",
    calcTitle: "Калькулятор стоимости",
    calcBtn: "Рассчитать",
    calcExample: "(например: 10 ч × 5000 KZT/ч = 50000 KZT)",
    calcResultText: "Итого: ",
    
  },
  kz: {
        siteTitle: "AliQ Group",
        slogan: "Бизнес пен қауіпсіздікке арналған IT-шешімдер.<br>Кәсібилік. Жылдамдық. Сенімділік.",
        heroDesc: "Жас IT-компания. Цифрлық өнімдерді іске қосамыз, сервистерді біріктіреміз, бизнесіңізді заманауи әрі қорғалған етеміз.<br><b>Бірінші жеке жоба <a href=\"http://aliguard.kz/\" target=\"_blank\">Aliguard.kz</a> (күзет қызметтерін табуға арналған платформа).</b>",
        requestBtn: "Өтініш қалдыру",
        servicesTitle: "Қызметтеріміз",
        services: [
          "MVP әзірлеу (цифрлық өнімдер)",
          "Сервистерді біріктіру (CRM, бұлт, чаттар, API)",
          "Заманауи сайттар мен лендингтер жасау",
          "IT-кеңес және аудит",
          "Бизнес-процестерді автоматтандыру",
          "Информқауіпсіздік және деректерді қорғау"
        ],
        projectsTitle: "Жобалар мен тәжірибе",
        projects: [
          "<a href=\"http://aliguard.kz/\" target=\"_blank\">Aliguard.kz</a> — күзет қызметтерін табуға арналған цифрлық платформа (MVP)",
          "Бизнеске арналған чат-боттар (Telegram, WhatsApp)",
          "Бұлттық сервистерді енгізу және автоматтандыру",
          "Оқу орталықтарына, сервис компанияларға сайттар"
        ],
        advTitle: "Бізді не үшін таңдайды?",
        adv: [
          "Идеядан іске қосуға дейін толық цикл",
          "Икемділік, бюрократиясыз жұмыс",
          "IT және қауіпсіздікті терең түсіну",
          "Ашық және әділ коммуникация",
          "Қазақстан мен ТМД-дағы нақты тәжірибе"
        ],
        founderTitle: "Компания негізін қалаушылар",
        founderDesc: "<div class=\"founder-list\"><div class=\"founder-desc\">Әлібек Уразов – физикалық және цифрлық қорғаныс бойынша сарапшы. Запастағы офицер, инженер, қауіпсіздік пен IT саласында 20 жылдан астам.</div></div><div class=\"founder-desc\">Мамандарымыз ірі жобаларға қатысып, халықаралық сертификаттарға ие, құпиялылықты қатаң сақтаймыз.</div>",
        contactsTitle: "Байланыс",
        phoneLabel: "Телефон (WhatsApp):",
        namePlaceholder: "Атыңыз",
        phonePlaceholder: "Телефон",
        emailPlaceholder: "Email (міндетті емес)",
        serviceLabelText: "Қызмет:",
        questionPlaceholder: "Сұрағыңыз",
        messengerLabel: "Қай мессенджер арқылы жіберу:",
        submitBtn: "Жіберу",
        formSuccess: "Рақмет! Өтінішіңіз жіберілді.",
    qrText: "QR кодын сканерлеңіз немесе сілтемені көшіріңіз:",
    langBtn: "English",
    navHome: "Басты бет",
    navServices: "Қызметтер",
    navSchedule: "Кездесу",
    navFAQ: "FAQ",
    scheduleTitle: "Кеңес жоспарлау",
    scheduleDesc: "Ыңғайлы уақытты таңдау үшін күнтізбені пайдаланыңыз.",
    scheduleBtn: "Күнтізбені ашу",
    calcTitle: "Құнының калькуляторы",
    calcBtn: "Есептеу",
    calcExample: "(мысалы: 10 сағ × 5000 KZT/сағ = 50000 KZT)",
    calcResultText: "Жиынтығы: "
  },
  en: {
    siteTitle: "AliQ Group",
    slogan: "IT solutions for business and security.<br>Expertise. Speed. Reliability.",
    heroDesc: "A young IT company launching digital products, integrating services and keeping your business safe.<br><b>First own project <a href=\"http://aliguard.kz/\" target=\"_blank\">Aliguard.kz</a> (platform for finding security services).</b>",
    requestBtn: "Send request",
    servicesTitle: "Our services",
    services: [
      "MVP development",
      "Service integration (CRM, cloud, chats, API)",
      "Modern websites and landing pages",
      "IT consulting and audit",
      "Business process automation",
      "Information security"
    ],
    projectsTitle: "Projects & experience",
    projects: [
      "<a href=\"http://aliguard.kz/\" target=\"_blank\">Aliguard.kz</a> — platform for finding security services (MVP)",
      "Chat bots for business (Telegram, WhatsApp)",
      "Cloud services integration and automation",
      "Websites for training centers and service companies"
    ],
    advTitle: "Why choose us?",
    adv: [
      "Full cycle from idea to launch",
      "Flexibility without bureaucracy",
      "Deep IT and security expertise",
      "Transparent communication",
      "Real experience in Kazakhstan and CIS"
    ],
    founderTitle: "Company founders",
    founderDesc: "<div class=\"founder-list\"><div class=\"founder-desc\">Alibek Urazov, expert in physical and digital security. Reserve officer and engineer with over 20 years in security and IT.</div></div><div class=\"founder-desc\">Our team has worked on major projects, holds international certifications and strictly respects confidentiality.</div>",
    contactsTitle: "Contacts",
    phoneLabel: "Phone (WhatsApp):",
    namePlaceholder: "Your name",
    phonePlaceholder: "Phone",
    emailPlaceholder: "Email (optional)",
    serviceLabelText: "Service:",
    questionPlaceholder: "Your question",
    messengerLabel: "Send via:",
    submitBtn: "Send",
    formSuccess: "Thank you! Your request has been sent.",
    qrText: "Scan the QR code or copy the link:",
    langBtn: "Русский",
    navHome: "Home",
    navServices: "Services",
    navSchedule: "Meeting",
    navFAQ: "FAQ",
    scheduleTitle: "Schedule a consultation",
    scheduleDesc: "Use our calendar to pick a convenient time.",
    scheduleBtn: "Open calendar",
    calcTitle: "Cost calculator",
    calcBtn: "Calculate",
    calcExample: "(e.g.: 10 h × 5000 KZT/h = 50000 KZT)",
    calcResultText: "Total: ",
    
  }
};
// Вопросы по услугам
const serviceQuestions = {
  ru: [
    ['Описание проекта','Желаемые сроки','Предполагаемый бюджет','Контактное лицо','Дополнительная информация'],
    ['Текущие системы','Планируемые интеграции','Сроки внедрения','Ответственный специалист','Комментарии'],
    ['Тип сайта (корпоративный, лендинг и др.)','Предпочтительный дизайн','Примеры сайтов','Контакты и доп. пожелания'],
    ['Область аудита (инфраструктура, процессы и др.)','Цели консультации','Желаемые результаты','Время для проведения'],
    ['Основные задачи/процессы','Используемые инструменты','Проблемы, которые требуется решить','Сроки','Контактное лицо'],
    ['Текущая IT‑инфраструктура','Приоритетные риски/угрозы','Требуемые меры защиты','Контакты для связи']
  ],
  kz: [
    ['Жоба сипаттамасы','Қалаған мерзім','Болжамды бюджет','Байланыс тұлғасы','Қосымша ақпарат'],
    ['Қолданыстағы жүйелер','Жоспарланған біріктірулер','Енгізу мерзімі','Жауапты маман','Пікірлер'],
    ['Сайт түрі (корпоративтік, лендинг т.б.)','Қалаған дизайн','Сайт үлгілері','Байланыс және қосымша тілектер'],
    ['Аудит саласы (инфрақұрылым, процестер және т.б.)','Консультация мақсаты','Күтілетін нәтиже','Өткізу уақыты'],
    ['Негізгі міндеттер/процестер','Қолданылатын құралдар','Шешілуі тиіс мәселелер','Мерзімдер','Байланыс тұлғасы'],
    ['Қолданыстағы IT-инфрақұрылым','Маңызды қауіп-қатерлер','Қажетті қорғау шаралары','Байланыс үшін деректер']
  ],
  en: [
    ['Project description','Desired timeline','Estimated budget','Contact person','Additional info'],
    ['Current systems','Planned integrations','Implementation timeframe','Responsible specialist','Comments'],
    ['Type of site (corporate, landing, etc.)','Preferred design','Example sites','Contacts and wishes'],
    ['Audit scope (infrastructure, processes, etc.)','Consultation goals','Desired results','Time for conducting'],
    ['Key tasks/processes','Tools in use','Problems to solve','Timeline','Contact person'],
    ['Current IT infrastructure','Priority risks/threats','Required protection measures','Contact details']
  ],
};

const serviceIcons = ['bi-lightning','bi-diagram-3','bi-window','bi-puzzle','bi-gear','bi-shield-lock'];

const serviceDescriptions = {
  ru: [
    'Создаём минимально жизнеспособные продукты для проверки гипотез и быстрого выхода на рынок. Прототипируем интерфейсы и подбираем оптимальный стек технологий. Помогаем собрать обратную связь и дорабатываем проект до полноценного решения.',
    'Интегрируем CRM, облачные сервисы и API для повышения эффективности. Настраиваем обмен данными между системами и автоматизируем цепочки процессов. Помогаем избавиться от ручных операций и контролировать бизнес в реальном времени.',
    'Разрабатываем сайты и лендинги под современные стандарты. Оптимизируем скорость загрузки, внедряем адаптивный дизайн и готовим площадку к продвижению. Управлять контентом просто, а конверсия растёт.',
    'Помогаем оптимизировать IT-инфраструктуру и проводим аудит. Анализируем текущие процессы, выявляем узкие места и формируем стратегию развития. Сопровождаем внедрение новых технологий и даём рекомендации по безопасности.',
    'Автоматизируем процессы и повышаем производительность. Пишем скрипты, подключаем сторонние сервисы и строим отчётность. Снижаем количество ошибок и высвобождаем время сотрудников.',
    'Обеспечиваем защиту данных и информационную безопасность. Разрабатываем политики доступа, внедряем системы мониторинга и шифрования. Проводим тесты на проникновение и обучаем персонал.'
  ],
  kz: [
    'Гипотезаларды тексеру үшін MVP әзірлейміз.',
    'CRM және басқа сервистерді біріктіреміз.',
    'Заманауи сайттар жасаймыз.',
    'IT-аудит және кеңес береміз.',
    'Бизнес процесстерді автоматтандырамыз.',
    'Деректерді және ақпараттық қауіпсіздікті қамтамасыз етеміз.'
  ],
  en: [
    'We build MVPs to quickly test ideas.',
    'Integrate CRM, cloud and other services.',
    'Create modern websites and landings.',
    'Provide IT consulting and audit.',
    'Automate business processes.',
    'Ensure information security.'
  ],
};

let curLang = 'ru';
function setElText(id, html){ const el = document.getElementById(id); if(el) el.innerHTML = html; }
function setLang(lang) {
  curLang = lang;
  document.documentElement.lang = lang;
  const l = langs[lang];
  setElText('siteTitle', l.siteTitle);
  setElText('slogan', l.slogan);
  setElText('heroDesc', l.heroDesc);
  document.querySelectorAll('#requestBtn, #requestBtn2').forEach(btn => btn && (btn.innerText = l.requestBtn));
  setElText('servicesTitle', l.servicesTitle);
  const servicesEl = document.getElementById('servicesList');
  if(servicesEl) servicesEl.innerHTML = l.services.map((s,i)=>`<li class="service-item"><span onclick="showService(${i})"><i class="bi ${serviceIcons[i]} service-icon"></i>${s}</span><button class="service-btn" onclick="openModal('${s}')">${l.requestBtn}</button></li>`).join('');
  setElText('projectsTitle', l.projectsTitle);
  const projectsEl = document.getElementById('projectsList');
  if(projectsEl) projectsEl.innerHTML = l.projects.map(p=>`<li>${p}</li>`).join('');
  setElText('advTitle', l.advTitle);
  const advEl = document.getElementById('advList');
  if(advEl) advEl.innerHTML = l.adv.map(a=>`<li>${a}</li>`).join('');
  setElText('founderTitle', l.founderTitle);
  setElText('founderDesc', l.founderDesc);
  setElText('contactsTitle', l.contactsTitle);
  setElText('phoneLabel', l.phoneLabel);
  const nameInput=document.getElementById('nameInput'); if(nameInput) nameInput.placeholder = l.namePlaceholder;
  const phoneInput=document.getElementById('phoneInput'); if(phoneInput) phoneInput.placeholder = l.phonePlaceholder;
  const emailInput=document.getElementById('emailInput'); if(emailInput) emailInput.placeholder = l.emailPlaceholder;
  const qInput=document.getElementById('questionInput'); if(qInput) qInput.placeholder = l.questionPlaceholder;
  const servLabel=document.getElementById('serviceLabel'); if(servLabel) servLabel.innerText = l.serviceLabelText;
  setElText('messengerLabel', l.messengerLabel);
  const submit=document.getElementById('submitBtn'); if(submit) submit.innerText = l.submitBtn;
  const langBtn=document.getElementById('langBtn'); if(langBtn) langBtn.innerText = l.langBtn;
  setElText('navHome', l.navHome);
  setElText('navServices', l.navServices);
  setElText('navSchedule', l.navSchedule);
  setElText('navFAQ', l.navFAQ);
  setElText('scheduleTitle', l.scheduleTitle);
  setElText('scheduleDesc', l.scheduleDesc);
  const schedBtn=document.getElementById('scheduleBtn'); if(schedBtn) schedBtn.innerText = l.scheduleBtn;
  setElText('calcTitle', l.calcTitle);
  const calcBtn=document.getElementById('calcBtn'); if(calcBtn) calcBtn.innerText = l.calcBtn;
  setElText('calcExample', l.calcExample);
  setElText('formMsg', l.formSuccess);
  setElText('qrText', l.qrText);
}
    document.getElementById('langBtn').onclick = function() {
      const order = ['ru','kz','en'];
      const idx = order.indexOf(curLang);
      setLang(order[(idx+1)%order.length]);
    };
const yearEls = document.querySelectorAll('#year, #year2, #year3');
yearEls.forEach(el => el.innerText = new Date().getFullYear());
const qrCodeEl = document.getElementById('qrCode');
if(qrCodeEl){
  qrCodeEl.src = 'https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=' + encodeURIComponent(window.location.href);
  const siteLink = document.getElementById('siteLink');
  if(siteLink) siteLink.value = window.location.href;
}

const gCal = document.getElementById('gCal');
if(gCal){
  gCal.src = `https://calendar.google.com/calendar/embed?src=${window.CALENDAR_ID}&ctz=Asia%2FAlmaty`;
  const ics = document.getElementById('icsLink');
  if(ics) ics.href = `https://calendar.google.com/calendar/ical/${window.CALENDAR_ID}/public/basic.ics`;
}

function renderQuestions(service){
  const fieldsEl = document.getElementById('dynamicFields');
  const qInput = document.getElementById('questionInput');
  fieldsEl.innerHTML = '';
  if(!service){
    qInput.style.display = 'block';
    qInput.required = true;
    return;
  }
  const idx = langs[curLang].services.indexOf(service);
  const list = serviceQuestions[curLang][idx] || [];
  if(list.length===0){
    qInput.style.display = 'block';
    qInput.required = true;
    return;
  }
  qInput.style.display = 'none';
  qInput.required = false;
  fieldsEl.innerHTML = list.map(l=>`<input type="text" data-label="${l}" placeholder="${l}" class="dyn-field">`).join('');
}

    // Модалка
function openModal(service) {
  document.getElementById('modalBg').style.display = 'flex';
  document.getElementById('formMsg').style.display = 'none';
  const form = document.querySelector('#modalBg form');
  form.reset();
  document.getElementById('serviceName').innerText = service || '';
  document.getElementById('serviceInput').value = service || '';
  renderQuestions(service);
}
    function closeModal() {
      document.getElementById('modalBg').style.display = 'none';
    }
      function showService(idx){
        const info=document.getElementById('infoContent');
        if(info){
          info.innerText=serviceDescriptions[curLang][idx];
          const btn=document.getElementById('infoRequest');
          if(btn){
            btn.innerText=langs[curLang].requestBtn;
            btn.onclick=function(){openModal(langs[curLang].services[idx]);};
          }
          document.getElementById('infoBg').style.display='flex';
        }
      }
    function closeInfo(){ document.getElementById('infoBg').style.display='none'; }
    window.openModal = openModal; window.closeModal = closeModal; window.showService=showService; window.closeInfo=closeInfo;

    const modalBgEl=document.getElementById('modalBg');
    if(modalBgEl) modalBgEl.addEventListener('click',e=>{ if(e.target===modalBgEl) closeModal(); });
    const infoBgEl=document.getElementById('infoBg');
    if(infoBgEl) infoBgEl.addEventListener('click',e=>{ if(e.target===infoBgEl) closeInfo(); });

    // Отправка формы и переход в мессенджер
    async function sendForm(e) {
      e.preventDefault();
      const name = document.getElementById('nameInput').value;
      const phone = document.getElementById('phoneInput').value;
      const email = document.getElementById('emailInput').value;
      const service = document.getElementById('serviceInput').value;
      const questionInputEl = document.getElementById('questionInput');
      const extra = Array.from(document.querySelectorAll('#dynamicFields .dyn-field'))
        .map(f => `${f.dataset.label}: ${f.value}`)
        .filter(Boolean)
        .join('\n');
      const question = [extra, questionInputEl.value].filter(Boolean).join('\n');
      const messenger = document.getElementById('messengerSelect').value;
      const msgEl = document.getElementById('formMsg');
      msgEl.style.display = 'block';
      try {
        const fd = new FormData();
        fd.append('name', name);
        fd.append('phone', phone);
        fd.append('email', email);
        fd.append('service', service);
        fd.append('question', question);
        fd.append('messenger', messenger);
        const fileEl = document.getElementById('fileInput');
        if(fileEl && fileEl.files[0]) fd.append('file', fileEl.files[0]);
        const res = await fetch('/api/feedback', {
          method: 'POST',
          body: fd
        });
        if (!res.ok) throw new Error('fail');
        msgEl.style.color = '#37ff86';
      } catch (err) {
        console.error(err);
        msgEl.style.color = '#ffb347';
      }
      msgEl.innerText = langs[curLang].formSuccess;

      const text = encodeURIComponent(`Имя: ${name}\nТелефон: ${phone}\nEmail: ${email}\nУслуга: ${service}\nВопрос: ${question}`);
      let url = '';
      if (messenger === 'whatsapp') {
        url = `https://wa.me/77052546613?text=${text}`;
      } else {
        url = `https://t.me/aliqgroup?text=${text}`;
      }
      window.open(url, '_blank');

      document.querySelector('#modalBg form').reset();
      setTimeout(closeModal, 1800);
    }
    window.sendForm = sendForm;

    // Первичная установка языка
    setLang(curLang);

const observer = new IntersectionObserver(entries => {
      entries.forEach(e => {
        if(e.isIntersecting) e.target.classList.add('visible');
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));

    function applyTheme(){
      if(localStorage.theme==='light'){
        document.body.classList.add('light');
        const btn=document.getElementById('themeToggle');
        if(btn) btn.innerText='☀';
      }else{
        document.body.classList.remove('light');
        const btn=document.getElementById('themeToggle');
        if(btn) btn.innerText='☾';
      }
    }
    const themeBtn=document.getElementById('themeToggle');
    if(themeBtn){
      themeBtn.onclick=function(){
        localStorage.theme = localStorage.theme==='light' ? 'dark' : 'light';
        applyTheme();
      };
    }
    applyTheme();

    function applyColor(){
      const col=localStorage.color||'blue';
      const root=document.documentElement;
      if(col==='green'){ root.style.setProperty('--accent1','#2af598'); root.style.setProperty('--accent2','#009eeb'); }
      else if(col==='purple'){ root.style.setProperty('--accent1','#ff35a6'); root.style.setProperty('--accent2','#6e3bff'); }
      else { root.style.setProperty('--accent1','#36aaff'); root.style.setProperty('--accent2','#16c0f8'); }
    }
    const colorBtn=document.getElementById('colorToggle');
    if(colorBtn){
      colorBtn.onclick=function(){
        const cur=localStorage.color||'blue';
        localStorage.color=cur==='blue'?'green':(cur==='green'?'purple':'blue');
        applyColor();
      };
    }
    applyColor();

    const ga = document.getElementById('gaScript');
    if(ga) ga.src = 'https://www.googletagmanager.com/gtag/js?id=' + window.GA_ID;

    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('service-worker.js').then(reg => {
        if('PushManager' in window){
          navigator.serviceWorker.ready.then(r => r.pushManager.getSubscription()).then(sub => {
            if(!sub){
              const btn = document.createElement('button');
              btn.innerText = 'Подписаться на уведомления';
              btn.className = 'color-btn';
              btn.onclick = async () => {
                try {
                  const resp = await fetch('/vapidPublicKey');
                  const { key } = await resp.json();
                  const subscription = await reg.pushManager.subscribe({
                    userVisibleOnly: true,
                    applicationServerKey: urlB64ToUint8Array(key)
                  });
                  await fetch('/subscribe', {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify(subscription)
                  });
                  btn.remove();
                } catch(e){ console.error(e); }
              };
              document.body.appendChild(btn);
            }
          });
        }
      });
    }

    function urlB64ToUint8Array(base64String) {
      const padding = '='.repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
      const rawData = atob(base64);
      const outputArray = new Uint8Array(rawData.length);
      for (let i = 0; i < rawData.length; ++i) {
        outputArray[i] = rawData.charCodeAt(i);
      }
      return outputArray;
    }

    window.calcCost = function(){
      const h=parseFloat(document.getElementById('hoursInput').value)||0;
      const r=parseFloat(document.getElementById('rateInput').value)||0;
      const res=h*r;
      const out=document.getElementById('calcResult');
      out.innerText=res?langs[curLang].calcResultText+res+' KZT':'';
    };

